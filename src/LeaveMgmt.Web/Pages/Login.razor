@page "/"
@page "/login"
@layout LeaveMgmt.Web.Shared.AuthLayout
@using LeaveMgmt.Web.Models
@inject AuthService Auth
@inject NavigationManager Nav

<MudPaper Class="pa-6 mx-auto mt-12" MaxWidth="420px" Elevation="4">
    <MudText Typo="Typo.h5" Class="mb-4">Sign in</MudText>

    <EditForm Model="@_model" FormName="LoginForm" OnValidSubmit="OnSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <MudTextField T="string"
                      Label="Email"
                      @bind-Value="_model.Email"
                      Variant="Variant.Outlined"
                      FullWidth="true"
                      Required="true"
                      Class="mb-3"
                      InputAttributes="@(new Dictionary<string, object> { { "name", "Email" } })" />

        <MudTextField T="string"
                      Label="Password"
                      @bind-Value="_model.Password"
                      InputType="InputType.Password"
                      Variant="Variant.Outlined"
                      FullWidth="true"
                      Required="true"
                      Class="mb-4"
                      InputAttributes="@(new Dictionary<string, object> { { "name", "Password" } })" />

        <MudButton ButtonType="ButtonType.Submit"
                   Variant="Variant.Filled"
                   Color="Color.Primary"
                   FullWidth="true">
            SIGN IN
        </MudButton>
    </EditForm>
</MudPaper>

@code {
    private LoginBody _model = new();

    private async Task OnSubmit()
    {
        var ok = await Auth.LoginAsync(_model);
        if (ok != null)
        {
            Nav.NavigateTo("/dashboard", true);
        }
    }
}
